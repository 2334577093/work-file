<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>商户信息</title>
    <link rel="stylesheet" href="../css/index.css">
    <link href="https://res.wx.qq.com/open/libs/weui/1.1.1/weui.min.css" rel="stylesheet">
    <script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
</head>

<style>

    .right_btn_box {
        margin: 5%;
    }

    .banner_list {
        font-size: 120%;
    }

    .zhaomu-btn {
        width: 85%;
        top: 30%;
        right: -11%;
    }

    @media screen and (min-width: 300px) and  (max-width: 360px) {
        /*iphone 5*/
        .right_btn_box {
            margin: -11%;
            margin-top: 5%;
        }

        .banner_list {
            font-size: 100%;
        }

        .zhaomu-btn {
            width: 85%;
            top: 30%;
            right: -11%;
        }
    }

    @media screen and (min-width: 360px) and (max-width: 400px) {
        /*iphone 8*/
        .right_btn_box {
            margin: -11%;
            margin-top: 5%;
        }

        .banner_list {
            font-size: 100%;
        }

        .zhaomu-btn {
            width: 77%;
            top: 30%;
            right: -12.5%;
        }
    }

    @media screen and (min-width: 400px) and (max-width: 500px) {
        /*iphone 8plus*/
        .zhaomu-btn {
            width: 70%;
            top: 30%;
            right: -14%;
        }
    }
</style>
<body>
    <div class="shrz_one_a">
        <div style="width: 100%;height:47px;padding-bottom: 15px;">
            <div style="width: 40%;line-height: 15px;
        height: 15px;position: relative;top:25px;left:16px;border-left: solid 3px #00a8ff">
                <span style="margin-left: 13px;color: #a1a1a1">快捷卡签约</span>
            </div>
        </div>

        <div style="width: 100%;">
            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">持卡人姓名</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" id="accountName" name="accountName"
                               placeholder="持卡人姓名">
                    </div>
                </div>
            </div>
            <div style="width: 94.5%;margin-left: 5%;border: 0.5px solid #dbdbdb"></div>

            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">签约卡号</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input"  type="tel" pattern="[0-9]*" id="accountNo" name="accountNo"
                               placeholder="签约卡号">
                    </div>
                </div>
            </div>

            <div style="width: 94.5%;margin-left: 5%;border: 0.5px solid #dbdbdb"></div>
            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">手机号</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input"  id="mobile" name="mobile"
                               type="tel" pattern="[0-9]*" placeholder="银行卡预留手机号">
                    </div>
                </div>
            </div>

            <div style="width: 94.5%;margin-left: 5%;border: 0.5px solid #dbdbdb"></div>
            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">身份证</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" id="idCardNo" name="idCardNo" placeholder="持卡人身份证">
                    </div>
                </div>
            </div>

            <div style="width: 94.5%;margin-left: 5%;border: 0.5px solid #dbdbdb"></div>
            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">CVV码</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" id="cvv" name="cvv" 
                               type="tel" pattern="[0-9]*" placeholder="信用卡CVV码">
                    </div>
                </div>
            </div>

            <div style="width: 94.5%;margin-left: 5%;border: 0.5px solid #dbdbdb"></div>
            <div style="width: 100%;height: 44px; background: #fff">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">有效期</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" id="expireTime" name="expireTime" 
                               type="tel" pattern="[0-9]*" placeholder="信用卡有效期">
                    </div>
                </div>
            </div>

        
        </div>

        <div style="width: 100%;height: 50px;" id="infoBtn">

            <div style="width: 40%;height: 40px;margin: 0 auto;margin-top: 8%">
                <div class="btn"
                     onclick="preCreateOrder()"
                     style="font-weight: 300;color: #fff;font-size: 1.05rem;box-shadow: 1px 5px 20px 2px #91ccec;text-align: center;line-height: 32px;height: 32px;width: 100%;border-radius: 30px;background: #00a8ff">
                    下一步
                </div>
            </div>

        </div>
    </div>

<div style="width: 100%;height: 20px;"></div>

<div class="bobm_box">
    <img class="bobm_one" src="../img/loading.gif" alt="">
</div>

<script>
    // document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
    //     //WeixinJSBridge.call('hideOptionMenu');
    // });

    //

    // loading
    function loadHide(){
        $(".bobm_box").hide();
    }

    function loadShow(){
        $(".bobm_box").show();
    }
    
    function commitOrder() {
        //遮罩
        var $loadingToast = $('#loadingToast');
        $('#showLoadingToast').on('click', function () {
            if ($loadingToast.css('display') != 'none') return;
            $loadingToast.fadeIn(100);
            setTimeout(function () {
                $loadingToast.fadeOut(100);
            }, 2000);
        });
        weui.dialog({
            title: '温馨提示',
            content: '提交订单确认',
            className: 'custom-classname',
            buttons: [{
                label: '取消',
                type: 'default',
                onClick: function () {
                    //do something
                }
            }, {
                label: '确定',
                type: 'primary',
                onClick: function () {
                    $("#comfirmBtn").attr("disabled", true);
                    $("#form-commit").submit();
                    var $loadingToast = $('#loadingToast');
                    if ($loadingToast.css('display') != 'none') return;
                    $loadingToast.fadeIn(100);
                    setTimeout(function () {
                        $loadingToast.fadeOut(100);
                    }, 5000);
                }
            }]
        });
    }

    function preCreateOrder() {


        var accountName = $('#accountName').val().replace(/\s+/g, "");
        var accountNo = $('#accountNo').val();
        var mobile = $('#mobile').val().replace(/\s+/g, "");
        var idCardNo=$("#idCardNo").val().replace(/\s+/g, "");
        var cvv=$("#cvv").val().replace(/\s+/g, "");
        var expireTime=$("#expireTime").val().replace(/\s+/g, "");
        
        var o = "<?=$openid?>";
        if (accountName == '') {
            weui.alert('签约账户不能为空', {title: '操作失败'});
            return false;
        }
        if (accountNo == '') {
            weui.alert('签约卡号不能为空', {title: '操作失败'});
            return false;
        }
        if (!/^\d{12,32}$/.test(accountNo)) {
            weui.alert('签约卡号是否正确', {title: '操作失败'});
            return false;
        }
        if (!(/^1(3|4|5|6|7|8)\d{9}$/.test(mobile))) {
            weui.alert('手机号码有误，请重填', {title: '操作失败'});
            return false;
        }
        if (!/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(idCardNo)) {
            weui.alert('身份证格式有误', {title: '操作失败'});
            return false;
        }
        if (idCardNo == '') {
            weui.alert('身份证不能为空', {title: '操作失败'});
            return false;
        }
        if(cvv==""){
            weui.alert('信用卡CVV码不能为空', {title: '操作失败'});
            return false;
        }
        if(expireTime==""){
            weui.alert('信用卡有效期不能为空', {title: '操作失败'});
            return false;
        }
        
        var jsonData={
                accountName:accountName,
                accountNo:accountNo,
                mobile:mobile,
                idCardNo:idCardNo,
                cvv:cvv,
                expireTime:expireTime
            }
        $.ajax({
            type: 'POST',
            url: "/trade/apply",
            // async: false,
            data:jsonData,
            dataType: 'json',
            success: function(data) {
                console.log(data);
                if(data.data.isHtml == '2'){
                    window.location.href="/trade/toConfirm";
                }
            }
        });
        return;
    }
</script>

</body>

</html>
